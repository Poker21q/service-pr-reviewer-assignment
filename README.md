# Service PR Reviewer Assignment

Сервис для распределения ревьюверов на pull requests.

## Архитектура

Приложение спроектировано с использованием принципов **SOLID** и **чистой архитектуры**, организовано по слоям:

- **api**: слой обработки HTTP-запросов
- **service**: бизнес-логика, реализующая функциональные операции
- **storage**: слой взаимодействия с базой данных, ответственный за выполнение SQL-запросов
- **app**: инфраструктурный слой

Каждый слой изолирован и зависит только от интерфейсов внутренних слоев. Используется **Dependency Injection** для передачи зависимостей между компонентами.

## Преимущества реализации

### Управление транзакциями
- **Transaction manager** на базе avito-tech/go-transaction-manager
- **Разные уровни изоляции** для операций: SERIALIZABLE для записи, REPEATABLE READ для чтения

### Фишки
- **Graceful Shutdown** с health checks и circuit breaker(на мидлваре) (по гайдам [victoriametrics](https://victoriametrics.com/blog/go-graceful-shutdown))
- **Panic recovery middleware**
- **Структурированное логирование** на основе slog с возможностью обогащением контекста запросов
- **Простой слой storage**

```go
ctx = log.WithContext(ctx, "user_id", userID, "request_id", requestID) # Можно было сделать методом логгера, не успевал рефакторить
log.InfoContext(ctx, "Processing request")

{"Level": "INFO", "user_id": "some_id", "request_id": "some_id", msg: "Processing request"}
```

### Инструменты
- **Автоматизация кодогенерации** из OpenAPI спецификации
- **Вендоринг инструментов** сборки и линтинга (openapi-codegen, golangci-lint, gofumpt, goose)
- **Миграции БД** через Goose с версионированием
- **Линтинг** через golangci-lint

### Масштабируемость и тестируемость
- **Интерфейсная архитектура** для легкого тестирования и подмены реализаций
- **Модульная структура** для простого добавления новой функциональности

### Минусы и допущения

- **Поменял openapi.yaml** - все id типа данных uuidv4
- **Не покрыл тестами** - физически не успел покрыть юнитами и e2e (можно потестить через SwaggerUI)

## Инструменты

```bash
make tools
```

## Подготовка окружения

```bash
make all # кодогенерация, линтинг, форматирование и подготовка переменных окружения
```

## Запуск сервиса с PostgreSQL # специально не изолировал порт бд для того, чтобы подключиться через goose

## Миграции БД

```bash
make migrate-up
```

## Тестить ручками..., сори.