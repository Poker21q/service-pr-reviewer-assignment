# Service PR Reviewer Assignment

Сервис для распределения ревьюверов на pull requests.

## Архитектура

Приложение спроектировано с использованием принципов **SOLID** и **чистой архитектуры**, организовано по слоям:

- **api**: слой обработки HTTP-запросов
- **service**: бизнес-логика, реализующая функциональные операции
- **storage**: слой взаимодействия с базой данных, ответственный за выполнение SQL-запросов
- **app**: инфраструктурный слой

Каждый слой изолирован и зависит только от интерфейсов внутренних слоев. Используется **Dependency Injection** для передачи зависимостей между компонентами.

## Преимущества реализации

### Управление транзакциями
- **Transaction manager** на базе avito-tech/go-transaction-manager
- **Разные уровни изоляции** для операций: SERIALIZABLE для записи, REPEATABLE READ для чтения

### Production-ready фичи
- **Graceful Shutdown** с health checks и circuit breaker на мидлваре (по гайдам [victoriametrics](https://victoriametrics.com/blog/go-graceful-shutdown))
- **Panic recovery middleware** - сервис не падает при неожиданных ошибках
- **Структурированное логирование** на основе slog с возможностью обогащения контекста запросов
- **Query-билдер** для динамических SQL-запросов
- **Конфигурация через переменные окружения** -

### Инструменты и автоматизация
- **Кодогенерация** из OpenAPI спецификации
- **Вендоринг инструментов** сборки и линтинга (openapi-codegen, golangci-lint, gofumpt, goose)
- **Миграции БД** через Goose с версионированием
- **Линтинг** через golangci-lint

### Масштабируемость и тестируемость
- **Интерфейсная архитектура** для легкого тестирования и подмены реализаций
- **Модульная структура** для простого добавления новой функциональности

## Особенности реализации

### Логирование с контекстом
```go
ctx = log.WithContext(ctx, "user_id", userID, "request_id", requestID)
log.InfoContext(ctx, "Processing request")

// Результат в JSON:
{"time": "...", "level": "INFO", "msg": "Processing request", "user_id": "some_id", "request_id": "some_id"}
```

### Простой и storage слой
Минималистичная реализация без избыточной логики, но с поддержкой транзакций.

## Допущения

- **Модификация OpenAPI спецификации** - изменены типы id на uuidv4, добавлены новые типы ошибок и валидация
- **Отсутствие тестового покрытия** - физически не успел покрыть юнитами и e2e (можно тестировать через SwaggerUI)
- **Контекстное логирование через WithContext** - можно было реализовать методом логгера, но не успел рефакторить

### Установка инструментов
```bash
make tools
```

### Подготовка окружения
```bash
make all  # кодогенерация, линтинг, форматирование и подготовка переменных окружения
```

### Запуск сервиса с PostgreSQL
```bash
make run
```

### Применение миграций
```bash
make migrate-up
```

### Тестирование
API готово к тестированию через SwaggerUI. Извини за отсутствие автоматических тестов - временные ограничения.